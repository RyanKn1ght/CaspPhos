---
title: "Caspase Substrate Analysis"
author: "Ryan Knight"
date: "24/01/2021"
output: 
  bookdown::html_document2:
    fig_caption: yes
    css: "style.css"
bibliography: references.bib
---

<!-- Configuration of default code chunk options -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      results = FALSE,
                      fig.retina = 3)
```

```{r packages}
#Load requisite R libraries
library(tidyverse)
library(citr)
library(reticulate)

#Load function
source("functions/preparesites.R")

#Even if python is configured to anaconda in settings, this line must be run in order to knit.
use_condaenv("re-reticulate")
```

# Introduction

**Caspases** (**c**ysteine **asp**art**ases**), are a family of proteases that carry out essential roles in forms of programmed cell death. 

Cellular stress and infection promote the assembly of inflammasome complexes, leading to the activation of inflammatory caspases. Activation of these inflammatory caspases, Caspase-1, Caspase-4 and Caspase-5 in humans, and Caspase-1 and Caspase-11 in mice, induces a morphologically distinct form of programmed cell death known as pyroptosis. When undergoing pyroptosis, cells rupture and release their contents, including pro-inflammatory cytokines and danger signals to both prevent intracellular pathogen replication and induce an immune response.

Despite their namesake, there exists substantive evidence that caspases do not exclusively cleave substrates at aspartate residues but have a propensity to act at a variety of other amino acid residues [@seaman_2016], most notably glutamate, possessing similar acidic properties to aspartate.

For our previous work (unpublished data), we compiled a database of inflammatory caspase substrates. As appreciation is developing for the more nuanced nature of caspase cleavage site consensus sequences, this report aims to provide a reproducible analysis and visualisation of features of caspase cleavage sites.

# Materials and Methods

## Phosphate site analysis

The limited history of proteomic analysis performed on apopototic caspases suggested that phosphorylation at cleavage sites can impact the efficiency of proteolysis [@dix_2012].

```{r tidy-phosphate}

#Load raw format substrate table. Rename position notation with numbers to identify locations within the shorter sequence better.
file <- "./data/raw/caspase_substrates.csv"
substrates <- read.csv(file) %>% janitor::clean_names()
names(substrates)[c(12:20, 22, 24:33)] <- seq(1,20)

#Reduce table down to a list of sites that can be phosphorylated (S,T,Y) in deepphos format.
potential_sites <- substrates %>% 
  select(uniprot_id, species, cleaved_by, `1`:`9`, `10`, `11`:`20`, concatenated_p10_p10_sequence) %>%
  pivot_longer(names_to = "site", values_to = "residue", cols = c(`1`:`9`, `10`, `11`:`20`)) %>%
  relocate(site, .after = uniprot_id) %>%
  filter(residue %in% c("S","T","Y")) %>%
  rename(sequence = concatenated_p10_p10_sequence)

#The prediction algorithm handles sites in two groups, (S and T) and Y.
potential_sites_ST <- potential_sites %>% prepare_sites(c("S","T"))
potential_sites_Y <- potential_sites %>% prepare_sites("Y")

#Write to csv to retain the data.
#write.csv(potential_sites_ST, ".data/data.csv", col.names = F, row.names = F)
#write.csv(potential_sites_Y, ".data/processed/potential_sites_Y.csv", col.names = F, row.names = F)
#?write.csv
```

Data was tidied into an amenable format for analysis with phosphate site prediction software, DeepPhos [@luo_2019]

```{python deep-phos}
#Suppress warnings generated by future deprecated libraries
import warnings
warnings.filterwarnings('ignore')

#Load modified deepphos code
from deepphos import predict
#predict.predict_for_deepphos("test data.csv", site="S", predictFrame = "general")

train_file_name = './data/raw/test data.csv'
site = 'S','T'
predict.predict_for_deepphos(train_file_name, site, predictFrame='kinase', hierarchy='group', kinase='AGC')

```

Data was presented using ggseqlogo [@wagih_2017]

# Results










# References

